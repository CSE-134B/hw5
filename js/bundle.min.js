function authDataCallback(n){n?console.log("User "+n.uid+" is logged in with "+n.provider):(console.log("User is logged out"),window.location="login.html")}function selectImage(n){document.getElementById("icon1").style.border="none";document.getElementById("icon2").style.border="none";document.getElementById("icon3").style.border="none";document.getElementById("icon1").setAttribute("data-active","false");document.getElementById("icon2").setAttribute("data-active","false");document.getElementById("icon3").setAttribute("data-active","false");var t=document.getElementById(n);t.style.border="5px solid #42A5F5";t.setAttribute("data-active","true")}function authDataCallback(n){n?(console.log("User "+n.uid+" is logged in with "+n.provider),window.location="list.html"):console.log("User is logged out")}function authHandler(n,t){n?console.log("Login Failed!",n):(console.log("Authenticated successfully with payload:",t),firebasePersistUserAuth(t))}function firebaseLogin(n,t){oFirebaseRef.authWithPassword({email:n,password:t},authHandler)}function firebasePersistUserAuth(n){oFirebaseRef.child("users").child(n.uid).set({provider:n.provider,name:n.password.email.replace(/@.*/,"")});window.location="list.html"}function firebaseCreateUser(n,t){oFirebaseRef.createUser({email:n,password:t},function(n,t){n?console.log("Error creating user:",n):(console.log("Successfully created user account with uid:",t.uid),document.querySelector("#signInMessage").style.display,document.querySelector("#usermail").value="",document.querySelector("#password").value="")})}function authDataCallback(n){n?console.log("User "+n.uid+" is logged in with "+n.provider):(console.log("User is logged out"),window.location="login.html")}function authDataCallback(n){n?console.log("User "+n.uid+" is logged in with "+n.provider):(console.log("User is logged out"),window.location="login.html")}function selectImage(n){document.getElementById("icon1").style.border="none";document.getElementById("icon2").style.border="none";document.getElementById("icon3").style.border="none";document.getElementById("icon1").setAttribute("data-active","false");document.getElementById("icon2").setAttribute("data-active","false");document.getElementById("icon3").setAttribute("data-active","false");var t=document.getElementById(n);t.style.border="5px solid #42A5F5";t.setAttribute("data-active","true")}var oNotificationsRef,oCurDate,oFirebaseRef,cHabitsRef;oFirebaseRef==null&&(oFirebaseRef=new Firebase("http://boiling-torch-2236.firebaseIO.com/web/"));oNotificationsRef=oFirebaseRef.child("notifications");oCurDate=Date.now();oNotificationsRef.once("value",function(n){n.forEach(function(n){var t=n.val(),i=n.key();checkNotification(t,i)})});var checkNotification=function(n,t){var l;oCurDate=new Date(oCurDate);var r=0,s=new Date(n.last_updated),u=getWeeklyFrequency(n.weekly_frequency),f=oCurDate.getDate()-s.getDate(),h=0;if(f>1)if(f>7)h=f/7,r=u.length*n.daily_frequency*h;else{var e=oCurDate.getDay(),c=n.getDay(),o=0;if(e>c)for(o=c,i=0;i<u.length;i++)u[i]>o&&(r+=n.daily_frequency);else for(o=e,i=0;i<u.length;i++)u[i]<e&&(r+=n.daily_frequency)}else{var a=oCurDate.getHours(),y=s.getHours(),v=12/n.daily_frequency;for(i=1;i<n.daily_frequency+1;i++)a>8+i*v&&(r+=1)}if(r>0){l=oFirebaseRef.child("habits/"+t);l.once("value",function(n){var f=n.val(),i,u;showUserNotifications(r,f.title);i=new Firebase("http://boiling-torch-2236.firebaseIO.com/web/notifications/"+t);u=Date.now();i.update({last_updated:u})})}},getWeeklyFrequency=function(n){return aDays=[],n.indexOf("sunday")>-1&&aDays.push(0),n.indexOf("monday")>-1&&aDays.push(1),n.indexOf("tuesday")>-1&&aDays.push(2),n.indexOf("wednesday")>-1&&aDays.push(3),n.indexOf("thursday")>-1&&aDays.push(4),n.indexOf("friday")>-1&&aDays.push(5),n.indexOf("saturday")>-1&&aDays.push(6),aDays},showUserNotifications=function(n,t){alert("You have missed your habit: "+t+" "+n.round()+" times!")},oFirebaseRef=new Firebase("http://boiling-torch-2236.firebaseIO.com/web/");oFirebaseRef.onAuth(authDataCallback);$("input:radio").on("click",function(){if($(this).is(".theone")){$(this).prop("checked",!1).removeClass("theone");return}$("input:radio[name='"+$(this).prop("name")+"'].theone").removeClass("theone");$(this).addClass("theone")});document.querySelector("#save_p").onclick=function(){var t,e,n,h;if(!$("#title").val()){document.getElementById("noTitle").style.display="";return}if(!$("input:checkbox").is(":checked")){document.getElementById("noWFreq").style.display="";return}if(!$("input:radio").is(":checked")){if(!$("#others").val()){document.getElementById("noDFreq").style.display="";return}if($("#others").val()<$("#others").attr("min")){swal("Oops!","Please enter a valid Daily Frequency","error");return}}for($("input:radio").is(":checked")&&($("#others").val()>3?$("input:radio").prop("checked",!1):$("#others").attr("value","0")),document.getElementById("icon1").getAttribute("data-active")=="false"&&document.getElementById("icon2").getAttribute("data-active")=="false"&&document.getElementById("icon3").getAttribute("data-active")=="false"&&document.getElementById("icon4").setAttribute("data-active","true"),t=document.getElementsByClassName("icon"),e="",n=0;n<t.length;n++)t[n].getAttribute("data-active")=="true"&&(e=t[n].src.substring(t[n].src.indexOf("/img/"),t[n].src.length));var o=document.querySelector("#title").value,s=e,i="",r=0,c=document.querySelector("#description").value,l=document.querySelector("#others").value,u=document.getElementsByClassName("weekly-freq"),f=document.getElementsByClassName("daily-freq");for(console.log(u),console.log(f),n=0;n<u.length;n++)u[n].checked&&(i+=u[n].value+",");for(n=0;n<f.length;n++)f[n].checked&&(r=parseInt(f[n].value));console.log("title",o);console.log("Icon",s);console.log("Weekly",i);console.log("Daily",r);console.log("Others",l);h=oFirebaseRef.child("habits");oNewHabitRef=h.push();sHabitId=oNewHabitRef.key();oNewHabitRef.set({title:o,icon:s,weekly_frequency:i,daily_frequency:r,description:c,bestRecord:0,daysInARow:0,numCompleted:0});var a=oFirebaseRef.child("notifications"),v=Date.now(),y=a.child(sHabitId);y.set({habitTitle:o,weekly_frequency:i,daily_frequency:r,last_updated:v});window.location="list.html"};oFirebaseRef=new Firebase("https://boiling-torch-2236.firebaseio.com/web/");oFirebaseRef.onAuth(authDataCallback);document.querySelector("#loginButton").onclick=function(){var n=document.querySelector("#usermail").value,t=document.querySelector("#password").value;firebaseLogin(n,t)};document.querySelector("#signUpButton").onclick=function(){var n=document.querySelector("#usermail").value,t=document.querySelector("#password").value;firebaseCreateUser(n,t)};oFirebaseRef=new Firebase("http://boiling-torch-2236.firebaseIO.com/web/");cHabitsRef=oFirebaseRef.child("currentHabit");oFirebaseRef.onAuth(authDataCallback);window.onload=function(){var t=function(){console.log("entered function op-done")};document.querySelector(".op-del").onclick=function(){var i,r;console.log("entered function op-del");var n=this.parentNode.parentNode,t=n.querySelector("input[name=habit-id]").value,u=n.parentNode,f=oFirebaseRef.child("habits"+t),e=oFirebaseRef.child("notifications"+t);f.remove(i);i=function(n){n?console.log("Synchronization failed"):(console.log("Synchronization succeeded"),e.remove(r))};r=function(t){t?console.log("Synchronization failed"):(console.log("Synchronization succeeded"),u.removeChild(n))}}};var currentKey="",flag=null,oFirebaseRef=new Firebase("http://boiling-torch-2236.firebaseIO.com/web/");oFirebaseRef.onAuth(authDataCallback);cHabitsRef=oFirebaseRef.child("currentHabit");document.querySelector("#save_p").onclick=function(){if(!$("#title").val()){document.getElementById("noTitle").style.display="";return}if(!$("input:checkbox").is(":checked")){document.getElementById("noWFreq").style.display="";return}if(!$("input:radio").is(":checked")){if(!$("#others").val()){document.getElementById("noDFreq").style.display="";return}if($("#others").val()<$("#others").attr("min")){swal("Oops!","Please enter a valid Daily Frequency","error");return}}$("input:radio").is(":checked")&&($("#others").val()>3?$("input:radio").prop("checked",!1):$("#others").attr("value","0"));document.getElementById("icon1").getAttribute("data-active")=="false"&&document.getElementById("icon2").getAttribute("data-active")=="false"&&document.getElementById("icon3").getAttribute("data-active")=="false"&&document.getElementById("icon4").setAttribute("data-active","true");cHabitsRef.once("value",function(n){for(var r,l=n.val(),i=document.getElementsByClassName("icon"),h="",t=0;t<i.length;t++)i[t].getAttribute("data-active")=="true"&&(h=i[t].src.substring(i[t].src.indexOf("/img/"),i[t].src.length));var s=document.querySelector("#title").value,c=h,u="",f=0,a=document.querySelector("#description").value,v=document.querySelector("#others").value,e=document.getElementsByClassName("weekly-freq"),o=document.getElementsByClassName("daily-freq");for(console.log(e),console.log(o),t=0;t<e.length;t++)e[t].checked&&(u+=e[t].value+",");for(t=0;t<o.length;t++)o[t].checked&&(f=parseInt(o[t].value));console.log("title",s);console.log("Icon",c);console.log("Weekly",u);console.log("Daily",f);console.log("Others",v);r=oFirebaseRef.child("habits");r=r.child(l.key);sHabitId=r.key();r.set({title:s,icon:c,weekly_frequency:u,daily_frequency:f,description:a,bestRecord:0,daysInARow:0,numCompleted:0});var y=oFirebaseRef.child("notifications"),p=Date.now(),w=y.child(sHabitId);w.set({habitTitle:s,weekly_frequency:u,daily_frequency:f,last_updated:p});location.href="list.html"})};window.onload=function(){cHabitsRef.once("value",function(n){var i=n.val(),t=oFirebaseRef.child("habits");t=t.child(i.key);t.once("value",function(n){var t=n.val(),i,r;document.getElementById("title").value=t.title;document.getElementById("description").value=t.description;document.getElementById("title").value=t.title;t.icon=="/img/shopping.png"?selectImage("icon1"):t.icon=="/img/food.png"?selectImage("icon2"):t.icon=="/img/run.png"?selectImage("icon3"):t.icon=="/img/add.png"&&selectImage("icon4");var u="",f=document.getElementsByClassName("weekly-freq"),e=document.getElementsByClassName("daily-freq");for(i=0;i<t.weekly_frequency.length;i++)if(t.weekly_frequency[i]==","){for(r=0;r<f.length;r++)if(f[r].value==u){f[r].checked=!0;break}u=""}else u+=t.weekly_frequency[i];switch(t.daily_frequency){case 1:e[0].checked=!0;break;case 2:e[1].checked=!0;break;case 3:e[2].checked=!0}})})};