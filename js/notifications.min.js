if(null==oFirebaseRef)var oFirebaseRef=new Firebase("http://boiling-torch-2236.firebaseIO.com/web/");var oNotificationsRef=oFirebaseRef.child("users/"+uId+"/notifications"),oCurDate=Date.now();oNotificationsRef.once("value",function(a){a.forEach(function(a){var b=a.val(),c=a.key();checkNotification(b,c)})});var checkNotification=function(a,b){oCurDate=new Date(oCurDate);var c=0,d=new Date(a.last_updated),e=getWeeklyFrequency(a.weekly_frequency),f=oCurDate.getDate()-d.getDate();if(f>1)if(f>7)iWeeks=f/7,c=e.length*a.daily_frequency*iWeeks;else{var g=oCurDate.getDay(),h=a.getDay(),j=0;if(g>h)for(j=h,i=0;i<e.length;i++)e[i]>j&&(c+=a.daily_frequency);else for(j=g,i=0;i<e.length;i++)e[i]<g&&(c+=a.daily_frequency)}else{var k=oCurDate.getHours(),l=(d.getHours(),12/a.daily_frequency);for(i=1;i<a.daily_frequency+1;i++)k>8+i*l&&(c+=1)}if(c>0){var m=oFirebaseRef.child("users/"+uId+"habits/"+b);m.once("value",function(a){var d=a.val();showUserNotifications(c,d.title);var e=new Firebase("http://boiling-torch-2236.firebaseIO.com/web/users/"+uId+"notifications/"+b),f=Date.now(),g=0;g=d.daysInARow>d.bestRecord?d.daysInARow:d.bestRecord;var h=d.numMissed+c;e.update({last_updated:f}),m.update({bestRecord:g,numMissed:h})})}},getWeeklyFrequency=function(a){return aDays=[],a.indexOf("sunday")>-1&&aDays.push(0),a.indexOf("monday")>-1&&aDays.push(1),a.indexOf("tuesday")>-1&&aDays.push(2),a.indexOf("wednesday")>-1&&aDays.push(3),a.indexOf("thursday")>-1&&aDays.push(4),a.indexOf("friday")>-1&&aDays.push(5),a.indexOf("saturday")>-1&&aDays.push(6),aDays},showUserNotifications=function(a,b){alert("You have missed your habit: "+b+" "+a.round()+" times!")};